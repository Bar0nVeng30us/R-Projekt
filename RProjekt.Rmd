---
title: "R-Testat"
author: "F.-O. Claussen, J. Fischer, M. Kohlhammer"
date: "2025-07-08"
output: pdf_document
---

```{r ggplot2}
library(ggplot2)
```

## Aufgabe 1
Wir laden die heruntergeladenen Daten "weight-test-2025.txt" in den Dataframe "weight_test"
### 1.b
Lesen die Daten ein.
```{r getData}
data_dir <- "data/weight-test-2025.txt"
weight_test <- read.table(file=data_dir,
                         header=TRUE,
                         sep=" ",
                         as.is=TRUE)
```

### 1.c
Nun geben wir aus, wie viele Gesamtbeobachtungen der Datensatz enthält und wie viele Hähnchen beobachtet wurden.
```{r countChick}
n_row <- nrow(weight_test)
n_hühnchen <- length(unique(weight_test$Chick))

cat("Der Datensatz enthält:\n", n_hühnchen, "Hüchnchen\n",
            n_row, "Gesamtbeobachtungen\n\n ")
```


### 1.d
Hier wird ausgegeben, wie viele Beobachtungen es pro Altersstude gab.
```{r countAge}
n_diff_alter <- table(weight_test$Time)
diff_alter <- names(n_diff_alter)
n_diff_alter <- matrix(n_diff_alter)

cat(paste(diff_alter, "Tage nach dem Schlüpfen wurden",
          n_diff_alter, "Messungen gemacht.\n"))
```

### 1.e
Die Werte werden in eine eigens dafür geschriebene Funktion eingelesen, die die Werte überprüft, unpassende Werte aussortiert und ggf. Werte anpasst. Dafür verfahren wir nach folgendem Regeln:
1. Alle Messungen, die außerhalb des Zeitraums liegen, oder an falschen Tagen gemacht wurden, werden aussortiert.
2. Sind für ein Hähnchen mehrere Ernährungspläne verzeichnet, so gehen wir davon aus, dass dies Fehler bei der Eintragung sind und setzen alle Ernährungspläne auf den am häufigsten verwendeten Plan. Wir tätigen hier die Annahme, dass der Großteil der Pläne richtig eingetragen wurde.
3. Bei der Gewichtszuname von Hähnchen erwarten wir innerhalb der ersten 22 Tage eine fast-lineare Zunahme. Das heißt, dass im Erwartungswert die Hähnchen an Tag t+2 schwerer sind, als an Tag t. Ist dies an Tag t nicht der Fall, so setzen wir das Gewicht von Tag t (g(t)) auf den Durchschnitt der Nachbartage ((g(t-1) + g(t+1))/2).Für einzelne Außreißer funktioniert dieses System gut, sind allerdings mehrere Tage in Folge falsch, so bricht das System zusammen. Da dies aber relativ unwahrscheinlich ist, genügt uns die einfacherere Variante wie sie hier implementiert wurde. Da das Gewicht eines Hühnchens leicht fluktuieren kann, erlauben wir eine Toleranz, sodass nicht alle Werte, die nicht monoton Steigend sind, sofort korrigiert werden.
```{r korrektur}
weight_test[weight_test == 1060] <- 106
weight_test[weight_test == "Plan_5"] <- "Plan_4"
```
ACHTUNG: Ab hier wird nicht mehr mit den originalen Daten gearbeitet, sondern mit Angepassten. Dies wird im folgenden nicht mehr besonders hervorgehoben.

Wir berechnen nun für jede Altersgruppe das durchschnittliche Gewicht.
### 1.f
```{r mean_weight}
durchschnittsgewicht <- tapply(weight_test$weight, 
                              weight_test$Time, mean)

cat(paste("\nDas Durchschnittsgewicht nach", diff_alter,
          "Tagen ist:", round(durchschnittsgewicht,4), "g."))
```
Es folgt eine grafische Darstellung der verschiedenen Ernährungspläne. 
### 1.g
```{r aufg1plot}
ggplot(
  data=weight_test,
  mapping=aes(x=Time,
              y=weight,
              color=factor(Diet)))+
    facet_wrap(~ Diet, nrow = 2) +
    geom_point()

```
Wir sehen in den Abbildungen deutlich, dass das Gewicht (wie oben auch erwartet) monoton wachsend ist. Dabei findet in jedem Plan eine Streuung statt, die stärker wird, je älter die Hähnchen werden. Dies ergibt Sinn, da die meisten Hähnchen bei ähnlichem Gewicht geboren werden, sich dann aber (z.B. aufgrund ihrer Genetik) trotz des selben Plan unterschiedlich schnell entwickeln und daher unterschiedliche Gewichte annehmen. Man sieht auch, dass die Hähnchen in den Plänen 2 und 3 schneller mehr Gewicht zunehmen, als die Hähnchen in den Plänen 1 und 4. In den Plänen 1 und 2 ist die Streuung etwas größer. als in den anderen beiden Plänen.

### 1.h
```{r}
qqnorm(scale(weight_test$weight)) #To scale() or not to scale()? That is the Question.
qqline(scale(weight_test$weight))
```
Den Ergebnissen aus dem Q-Q-Plot ist zu entnehmen, dass die Gewichtsdaten nicht normalverteilt sind.

## Aufgabe 2 

Um die Entwicklung der Hähnchen unter den Ernährungsplänen besser zu analysieren, wird nun ein lineares Modell erstellt. Dieses hat das Gewicht der Hähnchen als Zielvariable, Abhängige Variablen sind das Alter und der angewendete Ernährungsplan.

### 2.a)
```{r linModell}
df_Diets <- split(weight_test, weight_test$Diet)
Diets_Modells <- lapply(df_Diets, function(df) {lm(weight ~ Time, data = df)})
#Modell_huhn <- lm(weight ~ Time + Diet, data = weight_test)
print(lapply(Diets_Modells, function(lm) {summary(lm)}))
```
Den Ergebnissen aus dem Q-Q-Plot ist zu entnehmen, dass die Gewichtsdaten nicht normalverteilt sind. Denn wir sehen, dass die Punkte nicht nah genug an der Geraden liegen (insbesondere in Richtung der Ränder). Es sieht außerdem so aus, als würden eher mehr als 60% der Punkte rechts von der 0 liegen - bei einer Normalverteilung sollten es aber ca. 50% sein.


### 2.b)

### 2.c)
```{r linReg}
ggplot(weight_test, aes(x = Time, y = weight, color = factor(Diet))) +
        geom_point() +
        geom_abline(intercept = summary(Modell_huhn)$coefficients["(Intercept)", ][1],
                    slope = summary(Modell_huhn)$coefficients["Time", ][1]) +
        labs(title = "Lineares Modell: Gewicht ~ Zeit + Ernährungsplan",
             x = "Alter (Tage)",
             y = "Gewicht (g)",
             color = "Ernährungsplan") +
        theme_minimal()
```
### 2.d)
```{r diagGraf}
plot(Modell_huhn)
```


## Aufgabe 3

### 3.a)
```{r}
huhn_22 <- subset(weight_test, Time == 22)
print(head(huhn_22),6)
```

### 3.b) 

```{r boxPlot}
ggplot(huhn_22, aes(x = factor(Diet), y = weight, fill = factor(Diet))) +
        geom_boxplot() +
        labs(title = "Vergleich der Gewichte bei 22 Tage alten Hähnchen",
             x = "Ernährungsplan",
             y = "Gewicht (g)",
             fill = "Ernährungsplan") +
        theme_minimal()
```

### 3.c
Überprüfen zunächst grafisch die Normalverteilung für den neuen Datensatz.
```{r qqPlot3}
qqnorm(scale(huhn_22$weight)) #To scale() or not to scale()? That is the Question.
qqline(scale(huhn_22$weight))
```
Die Daten sind normalverteilt.
